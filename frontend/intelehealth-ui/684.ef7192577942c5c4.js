"use strict";(self.webpackChunkintelehealth_ui=self.webpackChunkintelehealth_ui||[]).push([[684],{8684:(V,l,e)=>{e.r(l),e.d(l,{PrescriptionDownloadModule:()=>M});var h=e(6895),d=e(9671),v=e(8929),m=e(7266),t=e(4650),p=e(4476),u=e(5178),f=e(9581),g=e(7185),x=e(6270),w=e(5703),P=e(1481),y=e(9623);const b=["prescription"];function T(n,c){if(1&n){const i=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"button",4),t.NdJ("click",function(){t.CHM(i);const r=t.oxw();return t.KtG(r.download())}),t._uU(4," Download e-Prescription "),t.qZA()()(),t.TgZ(5,"div",5)(6,"page",6,7),t._UZ(8,"app-view-visit-prescription",8),t.qZA()()()}if(2&n){const i=t.oxw();t.xp6(8),t.Q6J("isDownloadPrescription",!0)("visitId",i.visitId)("download",i.eventsSubject.asObservable())}}let D=(()=>{class n{constructor(i,o,r,a,s,z,O,Y){this.route=i,this.router=o,this.authService=r,this.linkSvc=a,this.toastr=s,this.visitService=z,this.cs=O,this.meta=Y,this.opt={margin:1,filename:"eprescription.pdf",image:{type:"jpeg",quality:1},html2canvas:{scale:2},jsPDF:{unit:"pt",format:"a4",orientation:"portrait"}},this.visitId=null,this.hash=null,this.accessToken=null,this.prescriptionVerified=!1,this.eventsSubject=new v.xQ}ngOnInit(){this.hash=this.route.snapshot.paramMap.get("hash");const{accessToken:i,visitId:o}=window.history.state;i&&(this.accessToken=i,this.visitId=o),this.accessToken?(this.prescriptionVerified=!0,this.meta.updateTag({name:"viewport",content:"width=1024"})):this.getVisitFromHash()}emitEventToChild(i){this.eventsSubject.next(i)}getVisitFromHash(){this.linkSvc.getShortenedLink(this.hash).subscribe({next:i=>{i.success?(this.visitId=i.data.link.replace("/i/",""),this.fetchVisitPatient()):this.router.navigate(["/"])},error:()=>{this.router.navigate(["/"])}})}fetchVisitPatient(i=this.visitId){this.visitService.fetchVisitPatient(i).subscribe({next:o=>{if(o){this.patient=o.patient;const a=(Array.isArray(this.patient?.attributes)?this.patient?.attributes:[]).find(s=>s?.attributeType?.display===m.On.TELEPHONE_NUMBER);a&&a?.value.length>3?this.linkSvc.requestPresctionOtp(this.hash,a?.value).subscribe(s=>{s.success?(this.toastr.success(`OTP sent on ${this.authService.replaceWithStar(a?.value,"phone")} successfully!`,"OTP Sent"),this.router.navigate(["/session/verify-otp"],{state:{verificationFor:"presctiption-verification",via:"phone",val:a?.value,visitId:this.visitId},queryParams:{hash:this.hash}})):this.toastr.error(s.message,"Error")}):this.cs.openConfirmOpenMrsIdModal(this.patient?.identifiers[0].identifier).subscribe(s=>{s&&(this.prescriptionVerified=!0,this.meta.updateTag({name:"viewport",content:"width=1024"}))})}}})}download(){var i=this;return(0,d.Z)(function*(){i.emitEventToChild(!0)})()}ngOnDestroy(){this.meta.updateTag({name:"viewport",content:"width=device-width, initial-scale=1"})}}return n.\u0275fac=function(i){return new(i||n)(t.Y36(p.gz),t.Y36(p.F0),t.Y36(u.e),t.Y36(f.M),t.Y36(g._W),t.Y36(x.W),t.Y36(w.p),t.Y36(P.h_))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-prescription-download"]],viewQuery:function(i,o){if(1&i&&t.Gf(b,5),2&i){let r;t.iGM(r=t.CRH())&&(o.prescription=r.first)}},decls:1,vars:1,consts:[["class","col external-prescription-col",4,"ngIf"],[1,"col","external-prescription-col"],[1,"row","justify-content-center"],[1,"text-center"],["type","button","data-test-id","btnDownloadPrecription",1,"blue-btn","m-2",3,"click"],[1,"row"],["id","prescription","size","A4",1,"external-prescription"],["prescription",""],[3,"isDownloadPrescription","visitId","download"]],template:function(i,o){1&i&&t.YNc(0,T,9,3,"div",0),2&i&&t.Q6J("ngIf",o.visitId&&o.prescriptionVerified)},dependencies:[h.O5,y.S],styles:[".external-prescription-col page{background:white;display:block;margin:0 auto .5cm;box-shadow:0 0 .5cm #00000080}.external-prescription-col page[size=A4]{width:21cm;min-height:29.7cm}@media print{body,page{margin:0;box-shadow:0}}.external-prescription-col .blue-btn{background:var(--color-darkBlue);border:1px solid var(--color-darkBlue);color:var(--color-white);padding:8px 24px;min-width:119px;min-height:48px;border:1px solid var(--color-lightGray);border-radius:8px;font-size:18px;line-height:150%;font-weight:700}.external-prescription .title-con{padding:15px 10px 10px!important}.external-prescription .main-content{padding-top:10px!important}.external-prescription .main-content .data-section-title img{width:25px!important;height:25px!important}.external-prescription .main-content .data-section-title h6{font-size:15px!important}.external-prescription .logo{right:30px;background:var(--color-darkBlue);width:60px!important}.external-prescription .title-con h6{font-size:18px!important}.external-prescription .patient-img-item h6{font-size:15px!important}.external-prescription .mat-dialog-content{max-height:-moz-fit-content!important;max-height:fit-content!important}\n"],encapsulation:2}),n})();var S=e(6054),C=e(1075);const I=[{path:"",component:D}];let M=(()=>{class n{}return n.\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[p.Bz.forChild(I),h.ez,S.Y,C.m]}),n})()}}]);